{
  "app-id": "org.davmail.DavMail",
  "runtime": "org.freedesktop.Platform",
  "runtime-version": "18.08",
  "sdk": "org.freedesktop.Sdk",
  "sdk-extensions": [
    "org.freedesktop.Sdk.Extension.openjdk11"
  ],
  "finish-args": [
    /* couldn't get persist to work, needs access to .davmail.properties and davmail.log, could patch source... */
    "--filesystem=home",
    /* X11 access */
    "--socket=x11",
    "--share=ipc",
    /* Network access */
    "--share=network",
    "--env=JAVA_HOME=/app/jre"
  ],
  "build-options" : {
    "append-path": "/usr/lib/sdk/openjdk11/bin"
  },
  /* Could be done during the build below, but these are all related to relocation */
  "cleanup-commands": [
    "sed -i 's,/usr,/app,g'                        /app/bin/davmail",
    "sed -i 's,JAVA=java,JAVA=/app/jre/bin/java,g' /app/bin/davmail",
    "sed -i 's,/usr,/app,g'                        /app/share/applications/org.davmail.DavMail.desktop",
    "sed -i 's,Icon=.*,Icon=org.davmail.DavMail,g' /app/share/applications/org.davmail.DavMail.desktop"
  ],
  "modules": [
    /* TODO: put in openjfk11.json */
    /* TODO: put gradle deps in another git repo to cache */
    {
      "name": "openjdk",
      "buildsystem": "simple",
      "build-commands": [
        "/usr/lib/sdk/openjdk11/install.sh"
      ]
    },
    "shared-modules/gtk2/gtk2.json",
    {
      "name": "openjfx",
      "buildsystem": "simple",
      "build-commands": [
        "unzip openjfx-gradle-deps.zip -d /",
        "find /tmp/gradle",
        "gradle/bin/gradle  --gradle-user-home /tmp/gradle --project-cache-dir /tmp/gradle-project"
      ],
      "sources" : [
        {
          "type": "archive",
          "url": "http://hg.openjdk.java.net/openjfx/11-dev/rt/archive/11.0.1+1.tar.bz2",
          "sha256": "b60bf7ea6f77a854a75e8235a96b9ea067029b8fc35dcece032a02b028447169"
        },
        {
          "type": "archive",
          "url": "https://services.gradle.org/distributions/gradle-4.10.3-bin.zip",
          "sha256": "8626cbf206b4e201ade7b87779090690447054bc93f052954c78480fa6ed186e",
          "dest": "gradle"
        },
        {
          "type": "file",
          "path": "openjfx-gradle-deps.zip"
        }
      ]
    },
    {
      "name": "davmail",
      "buildsystem": "simple",
      "build-commands": [
        "sed -i s,-trunk,-3135, build.xml", /* version hack, update this when url changes */
        "ant/bin/ant prepare-dist",
        "install -Dp -m 755 src/bin/davmail /app/bin/davmail",
        "install -Dp -m 644 src/desktop/davmail.desktop /app/share/applications/org.davmail.DavMail.desktop",
        "install -Dp -m 644 dist/davmail.png /app/share/icons/hicolor/128x128/apps/org.davmail.DavMail.png",
        "install -Dp -m 644 src/appstream/org.davmail.DavMail.appdata.xml --target-directory=/app/share/appdata",
        "install -Dp -m 644 dist/davmail.jar /app/share/davmail/davmail.jar",
        "mkdir -p /app/share/davmail/lib",
        "find dist -name *.jar -exec install -Dp -m 644 \"{}\" /app/share/davmail/lib/ \\;"
      ],
      "sources" : [
        {
          "type": "archive",
          "url": "https://sourceforge.net/projects/davmail/files/davmail/5.4.0/davmail-src-5.4.0-3135.tgz",
          "sha256": "94ece91a785dddcd9870adb29cb067871fdc50aa16bb8ff6f46f1a707f67b40b"
        },
        {
          "type": "patch",
          "path": "0001-Show-main-window-on-Fedora-Gnome.patch"
        },
        {
          "type": "patch",
          "path": "davmail-appdata-validate.patch"
        },
        {
          "type": "archive",
          "url": "https://archive.apache.org/dist/ant/binaries/apache-ant-1.10.2-bin.tar.xz",
          "sha256": "361c8ad2ed8341416e323e7c28af10a8297170a80fdffba294a5c2031527bb6c",
          "dest": "ant"
        }
      ],
      "cleanup": [
        "swt*.jar",
        "libgrowl*.jar",
        "winrun4j*.jar"
      ]
    }
  ]
}
